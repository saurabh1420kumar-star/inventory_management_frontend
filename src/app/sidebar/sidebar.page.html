<!-- sidebar.page.html -->

<ion-content class="sidebar-content" [class.collapsed]="isCollapsed">
  <div class="sidebar-container" [class.collapsed]="isCollapsed">

    <!-- ========================= -->
    <!-- BRAND HEADER -->
    <!-- ========================= -->
    <div class="brand">
      <div class="logo"> <img src="assets/images/nectar.jpeg" alt="Nectar Logo"
          class="w-15 h-15 object-contain rotate-3 hover:rotate-0 rounded-2xl shadow-lg shadow-emerald-300/100 transform-rotate-3 transition-transform duration-300">
      </div>
      <div class="brand-text ml-2">
        <h2>Nectar Inventory Portal</h2>
      </div>

      <ion-button fill="clear" class="menu-toggle" (click)="onToggleSidebar()">
        <ion-icon [name]="isCollapsed ? 'chevron-forward-outline' : 'chevron-back-outline'">
        </ion-icon>
      </ion-button>
    </div>

    <!-- ========================= -->
    <!-- MENU (FEATURE CONTROLLED) -->
    <!-- ========================= -->
    <ng-container *appAcl="{ anyFeature: true }">

      <ion-list lines="none" class="menu-list">

        <!-- ===== DASHBOARD (Both mobile & desktop) ===== -->
        <ion-item routerLink="/dashboard" routerLinkActive="active" [routerLinkActiveOptions]="{ exact: true }" (click)="onMenuItemClick()">
          <ion-icon name="albums-outline" slot="start"></ion-icon>
          <ion-label>Dashboard</ion-label>
        </ion-item>

        <!-- ===== ACCOUNTS (Desktop only) ===== -->
        <ng-container *ngIf="isDesktop">
          <ion-accordion-group *appAcl="{ features: ['ACCOUNTS', 'ACCOUNTS_TRANSACTION'] }">
            <ion-accordion>
              <ion-item slot="header" button>
                <ion-icon name="reader-outline" slot="start"></ion-icon>
                <ion-label>Accounts</ion-label>
              </ion-item>

              <div slot="content">
                <ion-item *appAcl="'ACCOUNTS'" routerLink="/accounts-master" routerLinkActive="active" (click)="onMenuItemClick()">
                  <ion-label>Master</ion-label>
                </ion-item>
                <ion-item *appAcl="'ACCOUNTS_TRANSACTION'" routerLink="/accounts/transaction" routerLinkActive="active" (click)="onMenuItemClick()">
                  <ion-label>Transaction</ion-label>
                </ion-item>
              </div>
            </ion-accordion>
          </ion-accordion-group>
        </ng-container>

        <!-- ===== HUMAN RESOURCES (Desktop only) ===== -->
        <ng-container *ngIf="isDesktop">
          <ion-accordion-group *appAcl="{ features: ['HR', 'HR_DESIGNATION', 'HR_EMPLOYEE'] }">
            <ion-accordion>
              <ion-item slot="header" button>
                <ion-icon name="people-outline" slot="start"></ion-icon>
                <ion-label>Human Resources</ion-label>
              </ion-item>

              <div slot="content">
                <ion-item *appAcl="'HR'" routerLink="/hr-department" routerLinkActive="active" (click)="onMenuItemClick()">
                  <ion-label>Department Master</ion-label>
                </ion-item>
                <ion-item *appAcl="'HR_DESIGNATION'" routerLink="/hr/designation-master" routerLinkActive="active" (click)="onMenuItemClick()">
                  <ion-label>Designation Master</ion-label>
                </ion-item>
                <ion-item *appAcl="'HR_EMPLOYEE'" routerLink="/hr/employee-master" routerLinkActive="active" (click)="onMenuItemClick()">
                  <ion-label>Employee Master</ion-label>
                </ion-item>
              </div>
            </ion-accordion>
          </ion-accordion-group>
        </ng-container>

        <!-- ===== DISTRIBUTOR (Mobile only) ===== -->
        <ng-container *ngIf="isMobile">
          <ion-accordion-group *appAcl="{ features: ['DISTRIBUTOR'] }">
            <ion-accordion>
              <ion-item slot="header" button>
                <ion-icon name="business-outline" slot="start"></ion-icon>
                <ion-label>Distributor</ion-label>
              </ion-item>

              <div slot="content">
                <ion-item *appAcl="'DISTRIBUTOR'" routerLink="/distributor" routerLinkActive="active" (click)="onMenuItemClick()">
                  <ion-label>Distributor Master</ion-label>
                </ion-item>
              </div>
            </ion-accordion>
          </ion-accordion-group>
        </ng-container>
        <ng-container *ngIf="isMobile">
        <ion-accordion-group *appAcl="{ features: ['SALES'] }">
          <ion-accordion>
            <ion-item slot="header" button>
              <ion-icon name="trending-up-outline" slot="start"></ion-icon>
              <ion-label>Sales</ion-label>
            </ion-item>

            <div slot="content">
              <ion-item *appAcl="'SALES'" routerLink="/sales" routerLinkActive="active">
                <ion-label>Sales Management</ion-label>
              </ion-item>
            </div>
          </ion-accordion>
        </ion-accordion-group>
        </ng-container>

        <!-- ===== INVENTORY (Desktop only) ===== -->
        <ng-container *ngIf="isDesktop">
          <ion-accordion-group *appAcl="{ features: ['INVENTORY_MASTERS', 'INVENTORY_TRANSACTIONS'] }">
            <ion-accordion>
              <ion-item slot="header" button>
                <ion-icon name="cube-outline" slot="start"></ion-icon>
                <ion-label>Inventory</ion-label>
              </ion-item>

              <div slot="content">
                <ion-item *appAcl="'INVENTORY_MASTERS'" routerLink="/master-inventory" routerLinkActive="active" (click)="onMenuItemClick()">
                  <ion-label>Master Inventory</ion-label>
                </ion-item>
                <ion-item *appAcl="'INVENTORY_MASTERS'" routerLink="/unit-master" routerLinkActive="active" (click)="onMenuItemClick()">
                  <ion-label>Unit Master</ion-label>
                </ion-item>
                <ion-item *appAcl="'INVENTORY_TRANSACTIONS'" routerLink="/machine-inventory" routerLinkActive="active" (click)="onMenuItemClick()">
                  <ion-label>Machine Parts</ion-label>
                </ion-item>
              </div>
            </ion-accordion>
          </ion-accordion-group>
        </ng-container>

        <!-- ===== ORDER TRACKING (Both mobile & desktop) ===== -->
        <ion-item *appAcl="{ features: ['ORDER_DETAILS'] }" routerLink="/order-details" routerLinkActive="active" (click)="onMenuItemClick()">
          <ion-icon name="document-text-outline" slot="start"></ion-icon>
          <ion-label>Order Tracking</ion-label>
        </ion-item>

        <!-- ===== COMPLAINTS & FEEDBACK (Both mobile & desktop) ===== -->
        <ion-item *appAcl="'COMPLAINT'" routerLink="/complaints" routerLinkActive="active" (click)="onMenuItemClick()">
          <ion-icon name="chatbubbles-outline" slot="start"></ion-icon>
          <ion-label>Complaints & Feedback</ion-label>
        </ion-item>

        <!-- ===== USER RIGHTS (Desktop only) ===== -->
        <ng-container *ngIf="isDesktop">
          <ion-item *appAcl="'USER_RIGHTS'" routerLink="/user-rights" routerLinkActive="active" (click)="onMenuItemClick()">
            <ion-icon name="shield-checkmark-outline" slot="start"></ion-icon>
            <ion-label>User Rights</ion-label>
          </ion-item>
        </ng-container>

        <ion-item *appAcl="'OPERATIONS'" routerLink="/operations" routerLinkActive="active" (click)="onMenuItemClick()">
          <ion-icon name="document-text-outline" slot="start"></ion-icon>
          <ion-label>Operations</ion-label>
        </ion-item>

      </ion-list>
    </ng-container>

    <!-- ========================= -->
    <!-- LOGOUT (ALWAYS VISIBLE) -->
    <!-- ========================= -->
    <div class="sidebar-footer">
      <div class="user-info">
        <div class="user-avatar-wrap">
          <ion-icon name="person-sharp" class="user-avatar"></ion-icon>
        </div>
        <div class="user-details">
          <p class="user-greeting">Hi, {{ userName }}</p>
          <span class="user-role">{{ userRole }}</span>
        </div>
        <app-logout class="logout-btn"></app-logout>
      </div>
    </div>

  </div>
</ion-content>